<?php
/*
Model för klassen USER
Här sker all databaskontakt för användare!
*/
class User_model extends CI_Model
{
    
    function __construct()
    {
        parent::__construct();
        $this->load->helper('security');
        $this->load->database();
    }
    
    /*
    Kollar om en användare finns i databasen.
    Active Records-funktionen get_where skyddar mot SQL-injection. (CI user_guide)    

    */
    function verify_user($username, $password)
    {
        return $this->db->get_where('users', array('Email' => $username , 'Password' => do_hash($password)));
    }
    function get_user($username)
    {
        return $this->db->get_where('users', array('Email' => $username));
    
    /*
    Hashar lösenordet samt lägger till användaren databasen

    */
    function insert_to_db($array)
    {
        if(! $this->is_name_taken($array['Email']))
        {
            $this->load->helper('security');
            $array['Password'] = do_hash($array['Password']);
            $this->db->insert('users', $array);

       }
    }
   
   /*
    Kollar om ett specifikt användarnamn finns i databasen
    */
   function is_name_taken($Email)
   {
       $query = $this->db->get_where('users', array('Email' => $Email));
       return ($query->num_rows() > 0);
    }
}


?>